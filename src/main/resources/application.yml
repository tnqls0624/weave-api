# =========================
# 공통 설정
# =========================
spring:
  profiles:
    active: local  # 기본 프로필 설정
  application:
    name: weave-api
  main:
    banner-mode: "console"
  threads:
    virtual:
      enabled: true
  jackson:
    time-zone: Asia/Seoul
    serialization:
      WRITE_DATES_AS_TIMESTAMPS: false
    default-property-inclusion: non_null

  data:
    mongodb:
      uri: mongodb://root:1234@localhost:27017/lovechedule?authSource=admin
      auto-index-creation: true
    redis:
      host: localhost
      port: 6379

  mvc:
    servlet:
      path: /api

  rsocket:
    server:
      transport: websocket
      mapping-path: /api/rsocket

server:
  port: 8080
  compression:
    enabled: true
    min-response-size: 2KB
  forward-headers-strategy: framework # 프록시/로드밸런서 뒤에서 Host/Proto 보존

# =========================
# 보안/JWT 예시 (값은 환경변수로 주입 권장)
# =========================
jwt:
  expiration: 31536000000 #
  refresh-expiration: 3153600000000
  private-key-path: # 비워두면 자동 생성
  public-key-path: # 비워두면 자동 생성

# =========================
# Firebase Cloud Messaging
# =========================
firebase:
  config-path: weave-75c40-firebase-adminsdk-fbsvc-ec0b3dc8b0.json

# =========================
# Holiday API
# =========================
holiday:
  api:
    service-key: HKTCByhZ2hJ6CAHKsSkFWkbbKnzP%2BgvJCgusOEqNAIiR1rTnkeu7ZxUaBFm31FXfOlYLPudEniZJTbYGDw%2FrVw%3D%3D
    base-url: https://apis.data.go.kr/B090041/openapi/service/SpcdeInfoService

# =========================
# springdoc-openapi (Swagger UI)
# =========================
springdoc:
  #  api-docs:
  #    path: /v3/api/docs
  swagger-ui:
    path: /swagger
    display-request-duration: true
    operations-sorter: method

# =========================
# AWS / S3
# =========================
aws:
  # 리전은 버킷이 생성된 리전과 동일하게 설정하세요. 예: ap-northeast-2 (서울)
  region: ${AWS_REGION:ap-northeast-2}
  s3:
    bucket: ${AWS_S3_BUCKET:lovechedule-s3}
    public-base-url: ${AWS_S3_PUBLIC_BASE_URL:}
    upload-prefix: ${AWS_S3_UPLOAD_PREFIX:${AWS_S3_UPLOAD_PATH:uploads/}}


# =========================
# Actuator / Micrometer (Prometheus)
# =========================
management:
  endpoints:
    web:
      base-path: /actuator
      exposure:
        include: health,info,metrics,prometheus,threaddump,heapdump
  endpoint:
    health:
      show-details: when_authorized
  metrics:
    tags:
      application: ${spring.application.name}
  prometheus:
    metrics:
      export:
        enabled: true
  observations:
    key-values:
      region: seoul

# =========================
# 로깅
# =========================
logging:
  level:
    root: info
    # Mongo 쿼리/연산 디버깅
    org.springframework.data.mongodb.core.MongoTemplate: debug
    org.springframework.data.mongodb.core.ReactiveMongoTemplate: warn
    org.springframework.data.mongodb.core.MongoOperations: debug
    org.mongodb.driver.protocol.command: info
    # Web / 시큐리티 트레이스가 필요할 때
    org.springframework.web: info
    org.springframework.security: info

# logback-slack-appender, loki-logback-appender는 별도의 logback-spring.xml 구성 필요

# =========================
# 프로필: local
# =========================
---
spring:
  config:
    activate:
      on-profile: local
  data:
    mongodb:
      uri: mongodb://root:1234@localhost:27017/lovechedule?authSource=admin
logging:
  file:
    path: ./logs/weave-api
  level:
    root: debug
    org.springframework.security: info
    org.springframework.web: info

# =========================
# 프로필: dev
# =========================
---
spring:
  config:
    activate:
      on-profile: dev
  data:
    mongodb:
      uri: mongodb://root:1234@localhost:27017/lovechedule?authSource=admin
logging:
  file:
    path: ./logs/weave-api
  level:
    root: info

# =========================
# 프로필: prod
# =========================
---
spring:
  config:
    activate:
      on-profile: prod
  cache:
    type: redis
  data:
    mongodb:
      uri: ${SPRING_DATA_MONGODB_URI:${MONGODB_URI}}
    redis:
      host: ${SPRING_DATA_REDIS_HOST:redis}
      port: ${SPRING_DATA_REDIS_PORT:6379}
      password: ${SPRING_DATA_REDIS_PASSWORD:}
jwt:
  expiration: ${JWT_EXPIRATION:31536000000}
  refresh-expiration: ${JWT_REFRESH_EXPIRATION:31536000000}
  private-key-path:
  public-key-path:
server:
  port: 8080
logging:
  file:
    path: /var/log/weave-api
  level:
    root: info