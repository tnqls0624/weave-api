groups:
  # ============================================
  # API Application Alerts
  # ============================================
  - name: weave-api
    interval: 30s
    rules:
      - alert: APIServiceDown
        expr: up{job="weave-api"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "ğŸš¨ Weave API ì„œë²„ ë‹¤ìš´"
          description: "API ì„œë¹„ìŠ¤ê°€ 1ë¶„ ì´ìƒ ì‘ë‹µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."

      - alert: HighErrorRate
        expr: |
          (sum(rate(http_server_requests_seconds_count{status=~"5.."}[5m])) or vector(0))
          / (sum(rate(http_server_requests_seconds_count[5m])) > 0) > 0.05
        for: 3m
        labels:
          severity: critical
        annotations:
          summary: "ğŸ”¥ ë†’ì€ ì—ëŸ¬ìœ¨ ê°ì§€"
          description: "5xx ì—ëŸ¬ìœ¨ì´ {{ $value | humanizePercentage }}ì…ë‹ˆë‹¤."

      - alert: SlowResponseTime
        expr: |
          histogram_quantile(0.95, sum(rate(http_server_requests_seconds_bucket[5m])) by (le)) > 3
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ğŸ¢ ì‘ë‹µ ì‹œê°„ ì§€ì—°"
          description: "P95 ì‘ë‹µì‹œê°„: {{ $value | humanizeDuration }}"

      - alert: HighMemoryUsage
        expr: |
          sum(jvm_memory_used_bytes{area="heap"}) / sum(jvm_memory_max_bytes{area="heap"}) > 0.85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ğŸ’¾ JVM ë©”ëª¨ë¦¬ ë¶€ì¡± ê²½ê³ "
          description: "í™ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : {{ $value | humanizePercentage }}"

      - alert: CriticalMemoryUsage
        expr: |
          sum(jvm_memory_used_bytes{area="heap"}) / sum(jvm_memory_max_bytes{area="heap"}) > 0.95
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "ğŸ†˜ JVM ë©”ëª¨ë¦¬ ìœ„í—˜"
          description: "í™ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : {{ $value | humanizePercentage }} - OOM ìœ„í—˜!"

      - alert: HighGCTime
        expr: |
          sum(rate(jvm_gc_pause_seconds_sum[5m])) > 0.5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "â™»ï¸ GC ì‹œê°„ ê³¼ë‹¤"
          description: "GCì— ì´ˆë‹¹ {{ $value | humanizeDuration }} ì†Œìš” ì¤‘"

  # ============================================
  # Container Alerts
  # ============================================
  - name: containers
    interval: 30s
    rules:
      - alert: ContainerDown
        expr: |
          absent(container_last_seen{name=~"weave_api.*"}) or 
          (time() - container_last_seen{name=~"weave_api.*"}) > 60
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "ğŸ³ API ì»¨í…Œì´ë„ˆ ë‹¤ìš´"
          description: "weave_api ì»¨í…Œì´ë„ˆê°€ ì‘ë‹µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."

      - alert: ContainerHighCPU
        expr: |
          sum by (name) (rate(container_cpu_usage_seconds_total{name=~".+"}[5m])) > 0.8
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ğŸ”¥ ì»¨í…Œì´ë„ˆ CPU ë†’ìŒ"
          description: "{{ $labels.name }} CPU ì‚¬ìš©ë¥ : {{ $value | humanizePercentage }}"

      - alert: ContainerHighMemory
        expr: |
          (sum by (name) (container_memory_usage_bytes{name=~".+"}) 
          / sum by (name) (container_spec_memory_limit_bytes{name=~".+"} > 0)) > 0.85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ğŸ’¾ ì»¨í…Œì´ë„ˆ ë©”ëª¨ë¦¬ ë†’ìŒ"
          description: "{{ $labels.name }} ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : {{ $value | humanizePercentage }}"

      - alert: ContainerCriticalMemory
        expr: |
          (sum by (name) (container_memory_usage_bytes{name=~".+"}) 
          / sum by (name) (container_spec_memory_limit_bytes{name=~".+"} > 0)) > 0.95
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "ğŸ†˜ ì»¨í…Œì´ë„ˆ ë©”ëª¨ë¦¬ ìœ„í—˜"
          description: "{{ $labels.name }} ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : {{ $value | humanizePercentage }} - OOMKill ìœ„í—˜!"

      - alert: ContainerRestarted
        expr: |
          increase(container_start_time_seconds{name=~".+"}[10m]) > 1
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "ğŸ”„ ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ë¨"
          description: "{{ $labels.name }}ì´(ê°€) ìµœê·¼ 10ë¶„ ë‚´ ì¬ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤."

  # ============================================
  # Infrastructure Alerts  
  # ============================================
  - name: infrastructure
    interval: 30s
    rules:
      - alert: MongoDBDown
        expr: |
          sum(mongodb_driver_pool_size) == 0 or absent(mongodb_driver_pool_size)
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "ğŸƒ MongoDB ì—°ê²° ì‹¤íŒ¨"
          description: "MongoDB ì»¤ë„¥ì…˜ í’€ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤."

      - alert: MongoDBHighLatency
        expr: |
          sum(rate(mongodb_driver_commands_seconds_sum[5m])) 
          / sum(rate(mongodb_driver_commands_seconds_count[5m])) > 0.5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ğŸŒ MongoDB ì‘ë‹µ ì§€ì—°"
          description: "MongoDB í‰ê·  ë ˆì´í„´ì‹œ: {{ $value | humanizeDuration }}"

      - alert: TomcatThreadsExhausted
        expr: |
          tomcat_threads_busy_threads / tomcat_threads_config_max_threads > 0.9
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "ğŸ§µ Tomcat ìŠ¤ë ˆë“œ ë¶€ì¡±"
          description: "ì‚¬ìš©ì¤‘ì¸ ìŠ¤ë ˆë“œ: {{ $value | humanizePercentage }} - ìš”ì²­ ì²˜ë¦¬ ë¶ˆê°€ ìœ„í—˜!"

      - alert: HighSystemCPU
        expr: system_cpu_usage > 0.9
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ğŸ”¥ ì‹œìŠ¤í…œ CPU ë†’ìŒ"
          description: "ì‹œìŠ¤í…œ CPU ì‚¬ìš©ë¥ : {{ $value | humanizePercentage }}"

  # ============================================
  # SSL Certificate Alerts
  # ============================================
  - name: ssl
    interval: 1h
    rules:
      - alert: SSLCertExpiringSoon
        expr: (probe_ssl_earliest_cert_expiry - time()) / 86400 < 30
        for: 1h
        labels:
          severity: warning
        annotations:
          summary: "ğŸ” SSL ì¸ì¦ì„œ ë§Œë£Œ ì„ë°•"
          description: "{{ $labels.instance }} ì¸ì¦ì„œê°€ {{ $value | printf \"%.0f\" }}ì¼ í›„ ë§Œë£Œë©ë‹ˆë‹¤."

      - alert: SSLCertExpiringCritical
        expr: (probe_ssl_earliest_cert_expiry - time()) / 86400 < 7
        for: 1h
        labels:
          severity: critical
        annotations:
          summary: "ğŸ†˜ SSL ì¸ì¦ì„œ ë§Œë£Œ ìœ„í—˜"
          description: "{{ $labels.instance }} ì¸ì¦ì„œê°€ {{ $value | printf \"%.0f\" }}ì¼ í›„ ë§Œë£Œë©ë‹ˆë‹¤!"

  # ============================================
  # Business / Traffic Alerts
  # ============================================
  - name: business
    interval: 1m
    rules:
      - alert: NoTraffic
        expr: |
          sum(rate(http_server_requests_seconds_count[5m])) == 0
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "ğŸ“‰ íŠ¸ë˜í”½ ì—†ìŒ"
          description: "10ë¶„ê°„ API ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤. ì„œë¹„ìŠ¤ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”."

      - alert: TrafficSpike
        expr: |
          sum(rate(http_server_requests_seconds_count[5m])) 
          > 3 * sum(rate(http_server_requests_seconds_count[1h] offset 1d))
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ğŸ“ˆ íŠ¸ë˜í”½ ê¸‰ì¦"
          description: "ìš”ì²­ëŸ‰ì´ ì „ì¼ ëŒ€ë¹„ 300% ì´ìƒ ì¦ê°€í–ˆìŠµë‹ˆë‹¤."

      - alert: High4xxRate
        expr: |
          sum(rate(http_server_requests_seconds_count{status=~"4.."}[5m])) 
          / sum(rate(http_server_requests_seconds_count[5m])) > 0.2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "âš ï¸ 4xx ì—ëŸ¬ ë‹¤ìˆ˜ ë°œìƒ"
          description: "4xx ì—ëŸ¬ìœ¨: {{ $value | humanizePercentage }} - í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ë¬¸ì œ í™•ì¸ í•„ìš”"
