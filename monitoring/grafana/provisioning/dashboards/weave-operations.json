{
  "uid": "weave-ops",
  "title": "\ud83d\udda5\ufe0f Weave Operations",
  "tags": [
    "operations",
    "weave"
  ],
  "timezone": "Asia/Seoul",
  "refresh": "30s",
  "schemaVersion": 38,
  "templating": {
    "list": []
  },
  "panels": [
    {
      "id": 100,
      "title": "",
      "type": "row",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "collapsed": false,
      "panels": []
    },
    {
      "id": 1,
      "title": "\ud83d\udfe2 \uc11c\ube44\uc2a4 \uc0c1\ud0dc",
      "type": "stat",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 0,
        "y": 1
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            {
              "type": "value",
              "options": {
                "1": {
                  "text": "UP",
                  "color": "green"
                }
              }
            },
            {
              "type": "value",
              "options": {
                "0": {
                  "text": "DOWN",
                  "color": "red"
                }
              }
            }
          ],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "red"
              },
              {
                "value": 1,
                "color": "green"
              }
            ]
          }
        }
      },
      "options": {
        "colorMode": "background",
        "graphMode": "none",
        "textMode": "value"
      },
      "targets": [
        {
          "expr": "up{job=\"weave-api\"}",
          "legendFormat": "API"
        }
      ]
    },
    {
      "id": 2,
      "title": "\u23f1\ufe0f Uptime",
      "type": "stat",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 4,
        "y": 1
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "dtdurations"
        }
      },
      "options": {
        "colorMode": "value",
        "graphMode": "none"
      },
      "targets": [
        {
          "expr": "process_uptime_seconds{job=\"weave-api\"}",
          "legendFormat": "Uptime"
        }
      ]
    },
    {
      "id": 3,
      "title": "\ud83d\udcca \uc694\uccad/\ucd08",
      "type": "stat",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 8,
        "y": 1
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "decimals": 1
        }
      },
      "options": {
        "colorMode": "value",
        "graphMode": "area"
      },
      "targets": [
        {
          "expr": "sum(rate(http_server_requests_seconds_count[5m]))",
          "legendFormat": "RPS"
        }
      ]
    },
    {
      "id": 4,
      "title": "\u26a1 \ud3c9\uade0 \uc751\ub2f5\uc2dc\uac04",
      "type": "stat",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 12,
        "y": 1
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "decimals": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 500,
                "color": "yellow"
              },
              {
                "value": 1000,
                "color": "red"
              }
            ]
          }
        }
      },
      "options": {
        "colorMode": "value",
        "graphMode": "area"
      },
      "targets": [
        {
          "expr": "sum(rate(http_server_requests_seconds_sum[5m])) / sum(rate(http_server_requests_seconds_count[5m])) * 1000",
          "legendFormat": "Latency"
        }
      ]
    },
    {
      "id": 5,
      "title": "\u274c \uc5d0\ub7ec\uc728",
      "type": "stat",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 16,
        "y": 1
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percentunit",
          "decimals": 2,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 0.01,
                "color": "yellow"
              },
              {
                "value": 0.05,
                "color": "red"
              }
            ]
          }
        }
      },
      "options": {
        "colorMode": "value",
        "graphMode": "area"
      },
      "targets": [
        {
          "expr": "sum(rate(http_server_requests_seconds_count{status=~\"5..\"}[5m])) / sum(rate(http_server_requests_seconds_count[5m])) or vector(0)",
          "legendFormat": "Error Rate"
        }
      ]
    },
    {
      "id": 6,
      "title": "\ud83d\udc65 \ud65c\uc131 \uc138\uc158",
      "type": "stat",
      "gridPos": {
        "h": 4,
        "w": 4,
        "x": 20,
        "y": 1
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short"
        }
      },
      "options": {
        "colorMode": "value",
        "graphMode": "area"
      },
      "targets": [
        {
          "expr": "tomcat_sessions_active_current_sessions",
          "legendFormat": "Sessions"
        }
      ]
    },
    {
      "id": 101,
      "title": "\ud83d\udcbe JVM & Memory",
      "type": "row",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 5
      },
      "collapsed": false
    },
    {
      "id": 10,
      "title": "JVM Heap \uc0ac\uc6a9\ub7c9",
      "type": "gauge",
      "gridPos": {
        "h": 6,
        "w": 6,
        "x": 0,
        "y": 6
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percentunit",
          "min": 0,
          "max": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 0.7,
                "color": "yellow"
              },
              {
                "value": 0.9,
                "color": "red"
              }
            ]
          }
        }
      },
      "targets": [
        {
          "expr": "sum(jvm_memory_used_bytes{area=\"heap\"}) / sum(jvm_memory_max_bytes{area=\"heap\"})",
          "legendFormat": "Heap"
        }
      ]
    },
    {
      "id": 11,
      "title": "JVM Memory (Heap/Non-Heap)",
      "type": "timeseries",
      "gridPos": {
        "h": 6,
        "w": 10,
        "x": 6,
        "y": 6
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "bytes",
          "custom": {
            "fillOpacity": 20
          }
        }
      },
      "targets": [
        {
          "expr": "sum(jvm_memory_used_bytes{area=\"heap\"})",
          "legendFormat": "Heap Used"
        },
        {
          "expr": "sum(jvm_memory_max_bytes{area=\"heap\"})",
          "legendFormat": "Heap Max"
        },
        {
          "expr": "sum(jvm_memory_used_bytes{area=\"nonheap\"})",
          "legendFormat": "Non-Heap"
        }
      ]
    },
    {
      "id": 12,
      "title": "GC \ud69f\uc218/\uc2dc\uac04",
      "type": "timeseries",
      "gridPos": {
        "h": 6,
        "w": 8,
        "x": 16,
        "y": 6
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "custom": {
            "fillOpacity": 10
          }
        }
      },
      "targets": [
        {
          "expr": "sum(rate(jvm_gc_pause_seconds_count[5m]))",
          "legendFormat": "GC Count/s"
        },
        {
          "expr": "sum(rate(jvm_gc_pause_seconds_sum[5m]))",
          "legendFormat": "GC Time/s"
        }
      ]
    },
    {
      "id": 102,
      "title": "\ud83c\udf10 HTTP & API",
      "type": "row",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 12
      },
      "collapsed": false
    },
    {
      "id": 20,
      "title": "\uc694\uccad\ub7c9 \ucd94\uc774",
      "type": "timeseries",
      "gridPos": {
        "h": 7,
        "w": 12,
        "x": 0,
        "y": 13
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "custom": {
            "fillOpacity": 30
          }
        }
      },
      "targets": [
        {
          "expr": "sum(rate(http_server_requests_seconds_count[5m]))",
          "legendFormat": "Total RPS"
        },
        {
          "expr": "sum(rate(http_server_requests_seconds_count{status=~\"2..\"}[5m]))",
          "legendFormat": "2xx"
        },
        {
          "expr": "sum(rate(http_server_requests_seconds_count{status=~\"4..\"}[5m]))",
          "legendFormat": "4xx"
        },
        {
          "expr": "sum(rate(http_server_requests_seconds_count{status=~\"5..\"}[5m]))",
          "legendFormat": "5xx"
        }
      ]
    },
    {
      "id": 21,
      "title": "\uc751\ub2f5\uc2dc\uac04 \ubd84\ud3ec (P50/P95/P99)",
      "type": "timeseries",
      "gridPos": {
        "h": 7,
        "w": 12,
        "x": 12,
        "y": 13
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "custom": {
            "fillOpacity": 10
          }
        }
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum(rate(http_server_requests_seconds_bucket[5m])) by (le))",
          "legendFormat": "P50"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(http_server_requests_seconds_bucket[5m])) by (le))",
          "legendFormat": "P95"
        },
        {
          "expr": "histogram_quantile(0.99, sum(rate(http_server_requests_seconds_bucket[5m])) by (le))",
          "legendFormat": "P99"
        }
      ]
    },
    {
      "id": 22,
      "title": "HTTP \uc0c1\ud0dc\ucf54\ub4dc \ubd84\ud3ec",
      "type": "piechart",
      "gridPos": {
        "h": 7,
        "w": 6,
        "x": 0,
        "y": 20
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "targets": [
        {
          "expr": "sum by (status) (increase(http_server_requests_seconds_count[1h]))",
          "legendFormat": "{{status}}"
        }
      ]
    },
    {
      "id": 23,
      "title": "Top 10 \ub290\ub9b0 \uc5d4\ub4dc\ud3ec\uc778\ud2b8",
      "type": "table",
      "gridPos": {
        "h": 7,
        "w": 18,
        "x": 6,
        "y": 20
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "s"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "uri"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 300
              }
            ]
          }
        ]
      },
      "options": {
        "sortBy": [
          {
            "displayName": "Value",
            "desc": true
          }
        ]
      },
      "transformations": [
        {
          "id": "sortBy",
          "options": {
            "fields": {},
            "sort": [
              {
                "field": "Value",
                "desc": true
              }
            ]
          }
        }
      ],
      "targets": [
        {
          "expr": "topk(10, sum by (uri, method) (rate(http_server_requests_seconds_sum[5m])) / sum by (uri, method) (rate(http_server_requests_seconds_count[5m])))",
          "format": "table",
          "instant": true
        }
      ]
    },
    {
      "id": 103,
      "title": "\ud83d\uddc4\ufe0f Database & Connections",
      "type": "row",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 27
      },
      "collapsed": false
    },
    {
      "id": 30,
      "title": "MongoDB \ucee4\ub125\uc158 \ud480",
      "type": "timeseries",
      "gridPos": {
        "h": 6,
        "w": 8,
        "x": 0,
        "y": 28
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short"
        }
      },
      "targets": [
        {
          "expr": "sum(mongodb_driver_pool_size)",
          "legendFormat": "Pool Size"
        },
        {
          "expr": "sum(mongodb_driver_pool_checkedout)",
          "legendFormat": "Checked Out"
        },
        {
          "expr": "sum(mongodb_driver_pool_waitqueuesize)",
          "legendFormat": "Wait Queue"
        }
      ]
    },
    {
      "id": 31,
      "title": "MongoDB \uba85\ub839 \ub808\uc774\ud134\uc2dc",
      "type": "timeseries",
      "gridPos": {
        "h": 6,
        "w": 8,
        "x": 8,
        "y": 28
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "s"
        }
      },
      "targets": [
        {
          "expr": "sum(rate(mongodb_driver_commands_seconds_sum[5m])) / sum(rate(mongodb_driver_commands_seconds_count[5m]))",
          "legendFormat": "Total Avg"
        },
        {
          "expr": "sum by (command) (rate(mongodb_driver_commands_seconds_sum[5m])) / sum by (command) (rate(mongodb_driver_commands_seconds_count[5m]))",
          "legendFormat": "{{command}}"
        }
      ]
    },
    {
      "id": 32,
      "title": "Tomcat \uc2a4\ub808\ub4dc",
      "type": "timeseries",
      "gridPos": {
        "h": 6,
        "w": 8,
        "x": 16,
        "y": 28
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short"
        }
      },
      "targets": [
        {
          "expr": "tomcat_threads_current_threads",
          "legendFormat": "Current"
        },
        {
          "expr": "tomcat_threads_busy_threads",
          "legendFormat": "Busy"
        },
        {
          "expr": "tomcat_threads_config_max_threads",
          "legendFormat": "Max"
        }
      ]
    },
    {
      "id": 104,
      "title": "\u2699\ufe0f System Resources",
      "type": "row",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 34
      },
      "collapsed": false
    },
    {
      "id": 40,
      "title": "CPU \uc0ac\uc6a9\ub960",
      "type": "gauge",
      "gridPos": {
        "h": 6,
        "w": 6,
        "x": 0,
        "y": 35
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percentunit",
          "min": 0,
          "max": 1,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              },
              {
                "value": 0.7,
                "color": "yellow"
              },
              {
                "value": 0.9,
                "color": "red"
              }
            ]
          }
        }
      },
      "targets": [
        {
          "expr": "process_cpu_usage",
          "legendFormat": "CPU"
        }
      ]
    },
    {
      "id": 41,
      "title": "CPU \uc0ac\uc6a9\ub960 \ucd94\uc774",
      "type": "timeseries",
      "gridPos": {
        "h": 6,
        "w": 9,
        "x": 6,
        "y": 35
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percentunit",
          "min": 0,
          "max": 1,
          "custom": {
            "fillOpacity": 20
          }
        }
      },
      "targets": [
        {
          "expr": "process_cpu_usage",
          "legendFormat": "Process CPU"
        },
        {
          "expr": "system_cpu_usage",
          "legendFormat": "System CPU"
        }
      ]
    },
    {
      "id": 42,
      "title": "JVM \uc2a4\ub808\ub4dc",
      "type": "timeseries",
      "gridPos": {
        "h": 6,
        "w": 9,
        "x": 15,
        "y": 35
      },
      "datasource": {
        "type": "prometheus",
        "uid": "PBFA97CFB590B2093"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short"
        }
      },
      "targets": [
        {
          "expr": "jvm_threads_live_threads",
          "legendFormat": "Live"
        },
        {
          "expr": "jvm_threads_daemon_threads",
          "legendFormat": "Daemon"
        },
        {
          "expr": "jvm_threads_peak_threads",
          "legendFormat": "Peak"
        }
      ]
    }
  ],
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": [
      "10s",
      "30s",
      "1m",
      "5m"
    ]
  }
}